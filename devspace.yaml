version: v1beta11

vars:
- name: IMAGE
  value: gcr.io/spectro-common-dev/tylergillson/cluster-api-provider-nested/nested-controller

images:
  controller:
    createPullSecret: false
    dockerfile: ./Dockerfile.dev
    image: ${IMAGE}
    tags:
    - dev
    rebuildStrategy: ignoreContextChanges
    build:
      docker:
        #args:
        #- "--no-cache"
        useBuildKit: true

deployments:
- name: nested-controller
  namespace: cluster-api-provider-vcluster-system
  kubectl:
    kustomize: true
    manifests:
    - config/default

dev:
  terminal:
    imageSelector: ${IMAGE}
    command:
    - ./devspace_start.sh
  ports:
  - imageSelector: ${IMAGE}
    forward:
    - port: 2345
  sync:
  - labelSelector:
      control-plane: controller-manager
    containerPath: /devspace
    excludePaths:
      - '**'
      - '!/pkg'
      - '!/api'
      - '!/controllers'
      - '!/vendor'
      - '!/hack'
      - '!/config'
      - '!/go.mod'
      - '!/go.sum'
      - '!/devspace_start.sh'
      - 'Makefile'
